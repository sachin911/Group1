<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Trader Make a Trade</title>
		<link rel="stylesheet" href="style/style.css">
	</head>
	<body>
		<header class="menu">
			<img class="menu__logo" src="images/Logo.png">

			<!-- Menu buttons -->

			</div>
		</header>
		<!-- Header menu buttons end -->
<form name="historyform" action="TradeHistoryServlet" method = "get"></form>

			<div class="menu__buttonbox">
				<input type="button" class="menu__button" value="HOME" onClick="location.href='traderhome1.jsp'">
				<input type="button" class="menu__button" value="INBOX" onClick="location.href='traderinbox.html'">
				<input type="button" class="menu__button selected" value="MAKE A TRADE" onClick="location.href='tradermakeatrade.html'">
				<input type="button" class="menu__button" value="PROFIT/LOSS" onClick="location.href='traderprofitloss.html'">
				<input type="button" class="menu__button" value="ORDER HISTORY" onClick="document.historyform.submit()">
				<input type="button" class="menu__button logoutbutton" value="LOG OUT" onClick="location.href='Logoutservlet'">
			</div>
		</header>
		<!-- Header menu buttons end -->

		<main class="tradermakeatrademain">
			<div class="makeatrade">
				<h2 class="makeatrade__header">Make a Trade</h2>
				<div class="scrollwrapper">
					<form method="post" action='TraderServlet' id="submit_form">
						<table class="makeatrade__table" id="maketradetable" name="tradetable">
							<tr>
								<th name="side">Side</th>
								<th name="symbol">Symbol</th>
								<th name="totalquantity">Total Quantity</th>
								<th name="currency">Currency</th>
								<th name="limitprice">Limit Price</th>
								<th name="stopprice">Stop Price</th>
								<th name="ordertype">Order Type</th>
								<th name="checkbox"></th>
							</tr>
							<tbody>
							<tr>
								<td><input type="text" class="table__input" name="sideinput"></td>
								<td><input type="text" class="table__input" name="symbolinput"></td>
								<td><input type="text" class="table__input" name="totalquantityinput"></td>
								<td><input type="text" class="table__input" name="currencyinput"></td>
								<td><input type="text" class="table__input" name="limitpriceinput"></td>
								<td><input type="text" class="table__input" name="stoppriceinput"></td>
								<td><input type="text" class="table__input" name="ordertypeinput"></td>
								<td><input type="checkbox" class="table__input" name="checkboxinput"></td>
							</tr>
							</tbody>
						</table>
						</form>
				</div>
					<button onclick="addRow('maketradetable')" class="createbutton generalbutton" name="addbutton">Add row</button>
					<button onclick="deleteRow('maketradetable')" class="deletebutton generalbutton" name="deletebutton">Delete row</button>
					<input type="submit" class="submittrade generalbutton" value="Submit" name="submittradebutton">
			</div>
	
		<!-- makeatrade table -->
			<div class="makeatradeinstructions">
				<h2 class="makeatradeinstructions__header">PM Trade Orders</h2>
				<div class="scrollwrapper">
					<table id="makeatradeinstructions__table" class="makeatradeinstructions__table" name="tradeinstructionstable">
						<thead>
							<tr>
								<th >Side</th>
								<th >Symbol</th>
								<th >Total Quantity</th>
								<th >Currency</th>
								<th >Limit Price</th>
								<th >Stop Price</th>
								<th >Order Type</th>
								<th ></th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td name="sideinstructions">Side</td>
								<td name="symbolinstructions">Symbol</td>
								<td name="totalquantityinstructions">Total Quantity</td>
								<td name="currencyinstructions">Currency</td>
								<td name="limitpriceinstructions">Limit Price</td>
								<td name="stoppriceinstructions">Stop Price</td>
								<td name="ordertypeinstructions">Order Type</td>
								<td><input type="checkbox" class="checkbox"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</main>
		<script src="JavaScript/makeatrade.js"></script>
		<script src="JavaScript/bundle.js"></script>
		<script src="https://code.jquery.com/jquery-3.1.0.js"   integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk="   crossorigin="anonymous"></script>
		<script>
		
		
		$('.submittrade').on('click',function(){
			 //e.preventDefault();
			    var header = $('table thead tr th').map(function () {
			        return $(this).text();
			    });

			    var tableObj = $('table tbody tr').map(function (i) {
			        var row = {};
			        $(this).find('td').each(function (i) {
			            var rowName = header[i];
			            row[rowName] = $(this).find("input").val();
			        });
			        return row;
			    }).get();

			    JSON.stringify(tableObj);
			    console.log(tableObj);
			    
			    $.ajax({
			    	url: 'TraderServlet',
			        type: 'POST',
			        //dataType: 'json',
					data: { 
					      tab_val: JSON.stringify(tableObj) // look here!
					    },
			       // contentType: 'application/json',
			    	success: function(response) {
/* 			    	         console.log(JSON.stringify(data))
			    	                     
			    	         console.log(JSON.parse(data)) */
			    	         
			    	         console.log("inserted into table");
			    	        
			    	    },
			    	fail : function(response){
			    		alert("its fucked");
			    	}
			    	});
			    
			});

		
		</script>
	</body>
</html>